<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Installing the application &#8212; Bumps 0.9.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=601dbdee" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <script src="../_static/documentation_options.js?v=9dc39874"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Server installation" href="server.html" />
    <link rel="prev" title="Getting Started" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="server.html" title="Server installation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Bumps 0.9.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Getting Started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installing the application</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="installing-the-application">
<span id="installing"></span><h1>Installing the application<a class="headerlink" href="#installing-the-application" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#building-from-source" id="id2">Building from source</a></p>
<ul>
<li><p><a class="reference internal" href="#windows" id="id3">Windows</a></p></li>
<li><p><a class="reference internal" href="#linux" id="id4">Linux</a></p></li>
<li><p><a class="reference internal" href="#os-x" id="id5">OS/X</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#fast-stepper-for-dream-on-mpi" id="id6">Fast Stepper for DREAM on MPI</a></p></li>
<li><p><a class="reference internal" href="#building-documentation" id="id7">Building Documentation</a></p></li>
<li><p><a class="reference internal" href="#windows-installer" id="id8">Windows Installer</a></p></li>
</ul>
</nav>
<p>Bumps 0.9.1 is provided as a Windows installer or as source:</p>
<blockquote>
<div><ul class="simple">
<li><p>Windows installer: <a class="reference external" href="http://www.reflectometry.org/danse/download.php?file=bumps-0.9.1-win32.exe">bumps-0.9.1-win32.exe</a></p></li>
<li><p>Apple installer: <a class="reference external" href="http://www.reflectometry.org/danse/download.php?file=Bumps 0.9.1.dmg">Bumps 0.9.1.dmg</a></p></li>
<li><p>Source: <a class="reference external" href="http://www.reflectometry.org/danse/download.php?file=bumps-0.9.1.zip">bumps-0.9.1.zip</a></p></li>
</ul>
</div></blockquote>
<p>The Windows installer walks through the steps of setting the program up
to run on your machine and provides the sample data to be used in the
tutorial.</p>
<section id="building-from-source">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Building from source</a><a class="headerlink" href="#building-from-source" title="Link to this heading">¶</a></h2>
<p>Before building bumps, you will need to set up your python environment.
We depend on many external packages.  The versions listed below are a
snapshot of a configuration that we are using.  The program may work with
older versions of the package, and we will try to keep it compatible with
the latest versions.</p>
<p>Our base scientific python environment contains:</p>
<blockquote>
<div><ul class="simple">
<li><p>python 2.7 (also tested on 2.6 and 3.5)</p></li>
<li><p>matplotlib 1.4.3</p></li>
<li><p>numpy 1.9.2</p></li>
<li><p>scipy 0.14.0</p></li>
<li><p>wxPython 3.0.0.0</p></li>
<li><p>setuptools 20.1.1</p></li>
</ul>
</div></blockquote>
<p>To run tests we use:</p>
<blockquote>
<div><ul class="simple">
<li><p>nose 1.3.0</p></li>
</ul>
</div></blockquote>
<p>To build the HTML documentation we use:</p>
<blockquote>
<div><ul class="simple">
<li><p>sphinx 1.3.1</p></li>
<li><p>docutils 0.12</p></li>
<li><p>jinja2 2.8</p></li>
</ul>
</div></blockquote>
<p>The PDF documentation requires a working LaTeX installation.</p>
<p>You can install directly from PyPI using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">bumps</span>
</pre></div>
</div>
<p>If this fails, then follow the instructions to install from the source
archive directly. Platform specific details for setting up your environment
are given below.</p>
<section id="windows">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Windows</a><a class="headerlink" href="#windows" title="Link to this heading">¶</a></h3>
<p>There are a number of python environments for windows, including:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda</a></p></li>
<li><p><a class="reference external" href="https://www.enthought.com/products/canopy/">Canopy</a></p></li>
<li><p><a class="reference external" href="http://code.google.com/p/pythonxy/">Python(X,Y)</a></p></li>
<li><p><a class="reference external" href="http://winpython.sourceforge.net/">WinPython</a></p></li>
</ul>
<p>You can also build your environment from the individually distributed
python packages.</p>
<p>You may want a C compiler to speed up parts of bumps. Microsoft Visual C++
for Python 2.7 is one option.  Once it is installed, you will need to
enable the compiler using vcvarsall 64.</p>
<p>Alternatively, your python environment may supply the MinGW C/C++ compiler,
but fail to set it as the default compiler.  To do so you will need to create
distutils configuration file in the python lib directory (usually
<em>C:Python27Libdistutilsdistutils.cfg</em>) with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">build</span><span class="p">]</span>
<span class="n">compiler</span><span class="o">=</span><span class="n">mingw32</span>
</pre></div>
</div>
<p>Next start a Windows command prompt in the directory containing the source.
This will be a command like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="s2">&quot;C:\Documents and Settings\&lt;username&gt;\My Documents</span><span class="se">\b</span><span class="s2">umps-src&quot;</span>
</pre></div>
</div>
<p>Now type the command to build and install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
<span class="n">python</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Now change to your data directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="s2">&quot;C:\Documents and Settings\&lt;username&gt;\My Documents\data&quot;</span>
</pre></div>
</div>
<p>To run the program use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">bumps</span><span class="o">.</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</section>
<section id="linux">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Linux</a><a class="headerlink" href="#linux" title="Link to this heading">¶</a></h3>
<p>Many linux distributions will provide the base required packages.  You
will need to refer to your distribution documentation for details.</p>
<p>On Ubuntu you can use:</p>
<blockquote>
<div><p>sudo apt-get install python-matplotlib python-scipy python-nose python-sphinx
sudo apt-get install python-wxgtk3.0</p>
</div></blockquote>
<p>From a terminal, change to the directory containing the bumps source and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="n">python</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
<span class="n">sudo</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>This should install the application somewhere on your path.</p>
<p>To run the program use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bumps</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</section>
<section id="os-x">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">OS/X</a><a class="headerlink" href="#os-x" title="Link to this heading">¶</a></h3>
<p>Building a useful python environment on OS/X is somewhat involved, and
frequently evolving so this document will likely be out of date.
We’ve had success using the <a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda</a>
64-bit python 2.7 environment from Continuum Analytics, which provides
the required packages, but other distributions should work as well.</p>
<p>You will need to install XCode from the app store, and set the preferences
to install the command line tools so that a C compiler is available (look
in the Downloads tab of the preferences window).  If any of your models
require fortran, you can download
<a class="reference external" href="http://r.research.att.com/tools/">gfortran binaries</a> from
r.research.att.com/tools (scroll down to the  Apple Xcode gcc-42 add-ons).
This sets up the basic development environment.</p>
<p>From a terminal, change to the directory containing the source and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conda create -n bumps numpy scipy matplotlib nose sphinx wxpython
source activate bumps
python setup.py install
python test.py
cd ..

# Optional: allow bumps to run from outside the bumps environment
    mkdir ~/bin # create user terminal app directory if it doesn&#39;t already exist
ln -s `python -c &quot;import sys;print sys.prefix&quot;`/bin/bumps ~/bin
</pre></div>
</div>
<p>To run the program, start a new Terminal shell and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bumps</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</section>
</section>
<section id="fast-stepper-for-dream-on-mpi">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Fast Stepper for DREAM on MPI</a><a class="headerlink" href="#fast-stepper-for-dream-on-mpi" title="Link to this heading">¶</a></h2>
<p>When running DREAM on larger clusters, we found a significant slowdown as the
number of processes increased.  This is due to Amdahl’s law, where the run
time speedup is limited by the slowest serial portion of the code.  In our
case, the DE stepper and the bounds check.  Compiling this in C with OpenMP
allows us to scale to hundreds of nodes until the stepper again becomes a
bottleneck.</p>
<p>To use the compiled DE stepper and bounds checks use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cd</span> <span class="n">bumps</span><span class="o">/</span><span class="n">dream</span> <span class="o">&amp;&amp;</span> <span class="n">cc</span> <span class="n">compiled</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">I</span> <span class="o">../../</span><span class="n">Random123</span><span class="o">/</span><span class="n">include</span><span class="o">/</span> <span class="o">-</span><span class="n">O2</span> <span class="o">-</span><span class="n">fopenmp</span> <span class="o">-</span><span class="n">shared</span> <span class="o">-</span><span class="n">lm</span> <span class="o">-</span><span class="n">o</span> <span class="n">_compiled</span><span class="o">.</span><span class="n">so</span> <span class="o">-</span><span class="n">fPIC</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: clang doesn’t support OpenMP, so on OS/X use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cd</span> <span class="n">bumps</span><span class="o">/</span><span class="n">dream</span> <span class="o">&amp;&amp;</span> <span class="n">cc</span> <span class="n">compiled</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">I</span> <span class="o">../../</span><span class="n">Random123</span><span class="o">/</span><span class="n">include</span><span class="o">/</span> <span class="o">-</span><span class="n">O2</span> <span class="o">-</span><span class="n">shared</span> <span class="o">-</span><span class="n">lm</span> <span class="o">-</span><span class="n">o</span> <span class="n">_compiled</span><span class="o">.</span><span class="n">so</span> <span class="o">-</span><span class="n">fPIC</span><span class="p">)</span>
</pre></div>
</div>
<p>This only works when _compiled.so is in the bumps/dream directory.  If running
from a pip installed version, you will need to fetch the bumps repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/bumps/bumps.git
$ cd bumps
</pre></div>
</div>
<p>Compile as above, then find the bumps install path using the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -c &quot;import bumps.dream; print(bumps.dream.__file__)&quot;
#dream/path/__init__.py
</pre></div>
</div>
<p>Copy the compiled module to the install (substituting #dream/path above):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cp bumps/dream/_compiled.so #dream/path
</pre></div>
</div>
<p>There is no provision for using _compiled.so in a frozen application.</p>
<p>Run with no more than 64 OMP threads.  If the number of processors is more
than 64, then use:</p>
<blockquote>
<div><p>OMP_NUM_THREADS=64 ./run.py …</p>
</div></blockquote>
<p>I don’t know how OMP_NUM_THREADS behaves if it is larger than the number
of processors.</p>
</section>
<section id="building-documentation">
<span id="docbuild"></span><h2><a class="toc-backref" href="#id7" role="doc-backlink">Building Documentation</a><a class="headerlink" href="#building-documentation" title="Link to this heading">¶</a></h2>
<p>Building the package documentation requires a working Sphinx installation and
a working LaTex installation.  Your latex distribution should include the
following packages:</p>
<blockquote>
<div><p>multirow, titlesec, framed, threeparttable, wrapfig,
collection-fontsrecommended</p>
</div></blockquote>
<p>You can then build the documentation as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cd</span> <span class="n">doc</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">clean</span> <span class="n">html</span> <span class="n">pdf</span><span class="p">)</span>
</pre></div>
</div>
<p>Windows users please note that this only works with a unix-like environment
such as <em>gitbash</em>, <em>msys</em> or <em>cygwin</em>.  There is a skeleton <em>make.bat</em> in
the directory that will work using the <em>cmd</em> console, but it doesn’t yet
build PDF files.</p>
<p>You can see the result of the doc build by pointing your browser to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bumps</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="n">bumps</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">latex</span><span class="o">/</span><span class="n">Bumps</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>ReStructured text format does not have a nice syntax for superscripts and
subscripts.  Units such as g·cm<sup>-3</sup> are entered using macros such as
|g/cm^3| to hide the details.  The complete list of macros is available in</p>
<blockquote>
<div><p>doc/sphinx/rst_prolog</p>
</div></blockquote>
<p>In addition to macros for units, we also define cdot, angstrom and degrees
unicode characters here.  The corresponding latex symbols are defined in
doc/sphinx/conf.py.</p>
<p>There is a bug in older sphinx versions (1.0.7 as of this writing) in which
latex tables cannot be created.  You can fix this by changing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">colspec</span><span class="p">)</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">colspec</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</pre></div>
</div>
<p>in site-packages/sphinx/writers/latex.py.  This may have been fixed in
newer versions.</p>
</section>
<section id="windows-installer">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Windows Installer</a><a class="headerlink" href="#windows-installer" title="Link to this heading">¶</a></h2>
<p>To build a windows standalone executable with py2exe you may first need
to create an empty file named
<em>C:\Python27\Lib\numpy\distutils\tests\__init__.py</em>.
Without this file, py2exe raises an error when it is searching for
the parts of the numpy package.  This may be fixed on recent versions
of numpy. Next, update the __version__ tag in bumps/__init__.py to mark
it as your own.</p>
<p>Now you can build the standalone executable using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup_py2exe</span>
</pre></div>
</div>
<p>This creates a dist subdirectory in the source tree containing
everything needed to run the application including python and
all required packages.</p>
<p>To build the Windows installer, you will need two more downloads:</p>
<blockquote>
<div><ul class="simple">
<li><p>Visual C++ 2008 Redistributable Package (x86) 11/29/2007</p></li>
<li><p><a class="reference external" href="http://www.jrsoftware.org/isdl.php">Inno Setup</a> 5.3.10 QuickStart Pack</p></li>
</ul>
</div></blockquote>
<p>The C++ redistributable package is needed for programs compiled with the
Microsoft Visual C++ compiler, including the standard build of the Python
interpreter for Windows.  It is available as vcredist_x86.exe from the
<a class="reference external" href="http://www.microsoft.com/downloads/">Microsoft Download Center</a>.
Be careful to select the version that corresponds to the one used
to build the Python interpreter — different versions can have the
same name.  For the Python 2.7 standard build, the file is 1.7 Mb
and is dated 11/29/2007.  We have a copy (<a class="reference external" href="http://www.reflectometry.org/danse/download.php?file=vcredist_x86.exe">vcredist_x86.exe</a>) on
our website for your convenience.  Save it to the <em>C:\Python27</em>
directory so the installer script can find it.</p>
<p>Inno Setup creates the installer executable.  When installing Inno Setup,
be sure to choose the ‘Install Inno Setup Preprocessor’ option.</p>
<p>With all the pieces in place, you can run through all steps of the
build and install by changing to the top level python directory and
typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">master_builder</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This creates the redistributable installer bumps-&lt;version&gt;-win32.exe for
Windows one level up in the directory tree.  In addition, source archives
in zip and tar.gz format are produced as well as text files listing the
contents of the installer and the archives.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Installing the application</a><ul>
<li><a class="reference internal" href="#building-from-source">Building from source</a><ul>
<li><a class="reference internal" href="#windows">Windows</a></li>
<li><a class="reference internal" href="#linux">Linux</a></li>
<li><a class="reference internal" href="#os-x">OS/X</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fast-stepper-for-dream-on-mpi">Fast Stepper for DREAM on MPI</a></li>
<li><a class="reference internal" href="#building-documentation">Building Documentation</a></li>
<li><a class="reference internal" href="#windows-installer">Windows Installer</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Getting Started</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="server.html"
                          title="next chapter">Server installation</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/getting_started/install.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="server.html" title="Server installation"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Bumps 0.9.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Getting Started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installing the application</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>